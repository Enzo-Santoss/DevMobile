<ion-header class="header">
  <ion-toolbar color="success">
    <ion-menu-button slot="start"></ion-menu-button>
    <ion-title>Atividade</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" *ngIf="atividadeData$ | async as data">

  <section class="activity-top">
    <div class="steps-card">
      <div class="steps-left">
        <div class="steps-number">{{ data.passosEstimados }}</div>
        <div class="steps-label">passos</div>
      </div>
      <div class="steps-right">
        <div class="metric">
          <div class="metric-value">{{ (data.distanciaMts / 1000) | number:'1.2-2' }} km</div>
          <div class="metric-label">dist√¢ncia</div>
        </div>
        <div class="metric">
          <div class="metric-value">{{ data.caloriasKcal | number:'1.0-0' }} kcal</div>
          <div class="metric-label">calorias</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Meta input (integrated into steps card) -->
  <div class="meta-area">
    <div class="meta-label">Meta de passos</div>
    <div class="meta-controls">
      <ng-container *ngIf="!metaEditing; else editBlock">
        <div class="meta-pill meta-editable" (click)="enableMetaEdit()" title="Clique para editar">
          {{ metaPassos }}
        </div>
        <button class="save-meta" style="display:none" (click)="testStep()" title="Adicionar um passo de teste">Adicionar passo (teste)</button>
      </ng-container>
      <ng-template #editBlock>
        <input id="meta-input" type="number" [(ngModel)]="metaPassos" (keyup.enter)="saveAndClose()" (blur)="saveAndClose()" />
        <button class="save-meta" (click)="saveAndClose()">Salvar</button>
      </ng-template>
    </div>
  </div>

  <!-- Progress bar towards meta -->
  <div class="progress-wrap" *ngIf="metaPassos && metaPassos > 0">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="(data.passosEstimados / metaPassos) * 100"></div>
    </div>
    <div class="progress-label">{{ ((data.passosEstimados / metaPassos) * 100) | number:'1.0-0' }}% da meta</div>
  </div>

</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-button expand="block" size="large" color="danger" (click)="testStep()" style="font-size:1.2em; margin: 16px 0;">
      Teste passo (teste)
    </ion-button>
  </ion-toolbar>
</ion-footer>